---
import { getCollection, render } from "astro:content";
import { ArrowLeft, ExternalLink, Github } from "@lucide/astro";
import BaseLayout from "../../../layouts/BaseLayout.astro";
import Badge from "../../../components/ui/Badge.astro";
import Button from "../../../components/ui/Button.astro";
import { getTranslations } from "../../../i18n";

export async function getStaticPaths() {
  const projects = await getCollection("projects");
  // Filter only English projects (those starting with "en/")
  const englishProjects = projects.filter((project) =>
    project.id.startsWith("en/"),
  );

  return englishProjects.map((project) => {
    // Extract the slug without the "en/" prefix for the URL
    const slug = project.id.split("/")[1];
    return {
      params: { slug },
      props: { project },
    };
  });
}

const { project } = Astro.props;
const { Content } = await render(project);
const locale = "en";
const t = getTranslations(locale);

const { data } = project;
// Data is now direct strings, no [locale] needed
const title = data.title;
const description = data.description;
---

<BaseLayout
  locale={locale}
  seo={{
    title,
    description,
    image: data.thumbnail,
  }}
>
  <div class="pt-24 pb-16 px-4 sm:px-6 lg:px-8">
    <div class="max-w-7xl mx-auto">
      {/* Back button */}
      <div class="mb-8">
        <a
          href="/en#portfolio"
          class="inline-flex items-center gap-2 text-zinc-600 dark:text-zinc-400 hover:text-blue-600 dark:hover:text-blue-400 transition-colors group"
        >
          <ArrowLeft
            class="w-4 h-4 group-hover:-translate-x-1 transition-transform"
          />
          {t.project.backToProjects}
        </a>
      </div>

      <div class="grid grid-cols-1 lg:grid-cols-12 gap-12">
        {/* Sidebar - Meta Info */}
        <aside class="lg:col-span-4 space-y-8 order-2 lg:order-1">
          {/* Thumbnail */}
          <div
            class="rounded-2xl overflow-hidden border border-zinc-200 dark:border-zinc-800 shadow-sm bg-zinc-50 dark:bg-zinc-900/50"
          >
            <img
              src={data.thumbnail}
              alt={data.thumbnailAlt}
              class="w-full h-auto object-cover aspect-video lg:aspect-auto"
            />
          </div>

          {/* Links */}
          <div class="flex flex-col gap-3">
            {
              data.liveUrl && (
                <Button
                  href={data.liveUrl}
                  variant="primary"
                  class="w-full justify-center gap-2 shadow-sm shadow-blue-500/20"
                >
                  <ExternalLink class="w-4 h-4" />
                  {t.project.viewDemo}
                </Button>
              )
            }
            {
              data.repoUrl && (
                <Button
                  href={data.repoUrl}
                  variant="outline"
                  class="w-full justify-center gap-2"
                >
                  <Github class="w-4 h-4" />
                  {t.project.viewCode}
                </Button>
              )
            }
          </div>

          {/* Tech Stack */}
          <div
            class="p-6 rounded-2xl bg-zinc-50 dark:bg-zinc-900/50 border border-zinc-200 dark:border-zinc-800"
          >
            <h3
              class="text-sm font-semibold text-zinc-900 dark:text-zinc-100 uppercase tracking-wider mb-4"
            >
              {t.project.techStack}
            </h3>
            <div class="flex flex-wrap gap-2">
              {
                data.stack.map((tech) => (
                  <Badge
                    variant="secondary"
                    class="bg-white dark:bg-zinc-800 border border-zinc-200 dark:border-zinc-700 shadow-sm"
                  >
                    {tech}
                  </Badge>
                ))
              }
            </div>
          </div>

          {/* Tags */}
          <div
            class="p-6 rounded-2xl bg-zinc-50 dark:bg-zinc-900/50 border border-zinc-200 dark:border-zinc-800"
          >
            <h3
              class="text-sm font-semibold text-zinc-900 dark:text-zinc-100 uppercase tracking-wider mb-4"
            >
              Tags
            </h3>
            <div class="flex flex-wrap gap-2">
              {
                data.tags.map((tag) => (
                  <Badge
                    variant="default"
                    class="bg-zinc-200 dark:bg-zinc-800 text-zinc-700 dark:text-zinc-300"
                  >
                    {tag}
                  </Badge>
                ))
              }
            </div>
          </div>
        </aside>

        {/* Main Content */}
        <main class="lg:col-span-8 order-1 lg:order-2">
          <header class="mb-10">
            <h1
              class="text-4xl md:text-5xl font-bold text-zinc-900 dark:text-zinc-100 mb-6 leading-tight"
            >
              {title}
            </h1>
            <p
              class="text-xl text-zinc-600 dark:text-zinc-400 leading-relaxed max-w-3xl"
            >
              {description}
            </p>
          </header>

          <div
            class="prose prose-lg prose-zinc dark:prose-invert max-w-none
            prose-headings:font-bold prose-headings:text-zinc-900 dark:prose-headings:text-zinc-100
            prose-p:text-zinc-600 dark:prose-p:text-zinc-300 prose-p:leading-relaxed
            prose-a:text-blue-600 dark:prose-a:text-blue-400 prose-a:no-underline hover:prose-a:underline
            prose-strong:text-zinc-900 dark:prose-strong:text-zinc-100
            prose-li:text-zinc-600 dark:prose-li:text-zinc-300
            prose-img:rounded-xl prose-img:shadow-lg prose-img:border prose-img:border-zinc-200 dark:prose-img:border-zinc-800"
          >
            <Content />
          </div>
        </main>
      </div>
    </div>
  </div>
</BaseLayout>
