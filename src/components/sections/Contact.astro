---
import { Mail } from '@lucide/astro';
import SocialLinks from '../SocialLinks.astro';
import { getTranslations } from '../../i18n';
import { siteConfig } from '../../data/site';
import type { Locale } from '../../types';

interface Props {
  locale: Locale;
}

const { locale } = Astro.props;
const t = getTranslations(locale);

const WEB3FORMS_KEY = '8d42850c-2326-43c2-9a46-3f9438415bea';
---

<section id="contact" class="py-20 px-4 bg-zinc-50 dark:bg-zinc-900/50">
  <div class="max-w-2xl mx-auto">
    <!-- Header -->
    <div class="text-center mb-10">
      <div class="inline-flex items-center justify-center w-16 h-16 rounded-full bg-blue-100 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400 mb-6">
        <Mail class="w-8 h-8" />
      </div>
      <h2 class="text-3xl md:text-4xl font-bold text-zinc-900 dark:text-zinc-100 mb-4">
        {t.contact.title}
      </h2>
      <p class="text-lg text-zinc-600 dark:text-zinc-400 max-w-lg mx-auto">
        {t.contact.subtitle}
      </p>
    </div>

    <!-- Contact Form -->
    <form
      id="contact-form"
      action="https://api.web3forms.com/submit"
      method="POST"
      class="space-y-5"
    >
      <input type="hidden" name="access_key" value={WEB3FORMS_KEY} />
      <input type="hidden" name="subject" value={`Nuevo mensaje desde ${siteConfig.url}`} />
      <input type="hidden" name="from_name" value="Portfolio Contact Form" />
      <input type="checkbox" name="botcheck" class="hidden" />

      <!-- Name -->
      <div>
        <label for="name" class="block text-sm font-medium text-zinc-700 dark:text-zinc-300 mb-2">
          {t.contact.form.name}
        </label>
        <input
          type="text"
          id="name"
          name="name"
          required
          placeholder={t.contact.form.namePlaceholder}
          class="w-full px-4 py-3 rounded-lg border border-zinc-300 dark:border-zinc-700 bg-white dark:bg-zinc-800 text-zinc-900 dark:text-zinc-100 placeholder-zinc-400 dark:placeholder-zinc-500 focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors"
        />
      </div>

      <!-- Email -->
      <div>
        <label for="email" class="block text-sm font-medium text-zinc-700 dark:text-zinc-300 mb-2">
          {t.contact.form.email}
        </label>
        <input
          type="email"
          id="email"
          name="email"
          required
          placeholder={t.contact.form.emailPlaceholder}
          class="w-full px-4 py-3 rounded-lg border border-zinc-300 dark:border-zinc-700 bg-white dark:bg-zinc-800 text-zinc-900 dark:text-zinc-100 placeholder-zinc-400 dark:placeholder-zinc-500 focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors"
        />
      </div>

      <!-- Message -->
      <div>
        <label for="message" class="block text-sm font-medium text-zinc-700 dark:text-zinc-300 mb-2">
          {t.contact.form.message}
        </label>
        <textarea
          id="message"
          name="message"
          required
          rows="5"
          placeholder={t.contact.form.messagePlaceholder}
          class="w-full px-4 py-3 rounded-lg border border-zinc-300 dark:border-zinc-700 bg-white dark:bg-zinc-800 text-zinc-900 dark:text-zinc-100 placeholder-zinc-400 dark:placeholder-zinc-500 focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors resize-none"
        ></textarea>
      </div>

      <!-- Submit Button -->
      <button
        type="submit"
        id="submit-btn"
        class="w-full px-6 py-3 bg-blue-700 hover:bg-blue-800 text-white font-medium rounded-lg transition-colors focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 dark:focus:ring-offset-zinc-900 disabled:opacity-50 disabled:cursor-not-allowed"
      >
        <span id="btn-text">{t.contact.form.send}</span>
        <span id="btn-loading" class="hidden">{t.contact.form.sending}</span>
      </button>

      <!-- Status Messages -->
      <div id="form-success" class="hidden p-4 rounded-lg bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-400 text-center">
        {t.contact.form.success}
      </div>
      <div id="form-error" class="hidden p-4 rounded-lg bg-red-100 dark:bg-red-900/30 text-red-700 dark:text-red-400 text-center">
        {t.contact.form.error}
      </div>
    </form>

    <!-- Alternative contact -->
    <div class="mt-10 pt-8 border-t border-zinc-200 dark:border-zinc-800 text-center">
      <p class="text-sm text-zinc-500 dark:text-zinc-400 mb-4">
        {t.contact.email}{' '}
        <a
          href={`mailto:${siteConfig.author.email}`}
          class="font-medium text-zinc-700 dark:text-zinc-300 hover:text-blue-600 dark:hover:text-blue-400 transition-colors"
        >
          {siteConfig.author.email}
        </a>
      </p>
      <div class="flex justify-center">
        <SocialLinks size="md" />
      </div>
    </div>
  </div>
</section>

<script>
  function setupContactForm() {
    const form = document.getElementById('contact-form') as HTMLFormElement;
    const submitBtn = document.getElementById('submit-btn') as HTMLButtonElement;
    const btnText = document.getElementById('btn-text');
    const btnLoading = document.getElementById('btn-loading');
    const successMsg = document.getElementById('form-success');
    const errorMsg = document.getElementById('form-error');

    if (!form) return;

    form.addEventListener('submit', async (e) => {
      e.preventDefault();

      // Hide previous messages
      successMsg?.classList.add('hidden');
      errorMsg?.classList.add('hidden');

      // Show loading state
      submitBtn.disabled = true;
      btnText?.classList.add('hidden');
      btnLoading?.classList.remove('hidden');

      try {
        const formData = new FormData(form);
        const response = await fetch(form.action, {
          method: 'POST',
          body: formData,
          headers: {
            Accept: 'application/json',
          },
        });

        if (response.ok) {
          successMsg?.classList.remove('hidden');
          form.reset();
        } else {
          throw new Error('Form submission failed');
        }
      } catch {
        errorMsg?.classList.remove('hidden');
      } finally {
        submitBtn.disabled = false;
        btnText?.classList.remove('hidden');
        btnLoading?.classList.add('hidden');
      }
    });
  }

  setupContactForm();
  document.addEventListener('astro:after-swap', setupContactForm);
</script>
